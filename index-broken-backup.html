<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modler V2 - Professional 3D Modeling</title>
    <link rel="stylesheet" href="styles/simple.css">
</head>
<body>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="foundation/scene-foundation.js"></script>
    <script src="foundation/input-foundation.js"></script>
    <script src="scene/scene-controller.js"></script>
    <script src="scene/visual-effects.js"></script>
    <script src="interaction/selection-controller.js"></script>
    <script src="interaction/input-handler.js"></script>
    <script src="application/tool-controller.js"></script>
    <script src="application/tools/select-tool.js"></script>
    <script src="application/tools/move-tool.js"></script>
    <script src="v2-main.js"></script>
    <script src="ui/modler-ui.js"></script>
    <script>
        
        // Global error handler for debugging
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
            console.error('File:', e.filename, 'Line:', e.lineno, 'Column:', e.colno);
            alert('JavaScript Error: ' + e.error.message + ' at ' + e.filename + ':' + e.lineno);
        });
        
        // Catch unhandled promise rejections too
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled Promise Rejection:', e.reason);
            alert('Promise Error: ' + e.reason);
        });
        
        console.log('=== Modler V2 System Integration Starting ===');
        
        try {
            // Step 1: Initialize UI layout first
            console.log('Creating UI layout...');
            initializeModlerUI(null);
            
            // Step 2: Get the canvas element
            const canvas = document.getElementById('canvas');
            if (!canvas) {
                throw new Error('Canvas element not found after UI initialization');
            }
            console.log('Canvas element found:', canvas);
            
            // Step 3: Initialize V2 system directly (no complex timing)
            console.log('Initializing V2 system...');
            initializeModlerV2(canvas).then((success) => {
                if (success) {
                    console.log('V2 system initialized successfully');
                    
                    // Step 4: Connect UI to V2 systems
                    const finalUI = initializeModlerUI(modlerV2Components);
                    
                    // System initialized successfully
                    const status = getModlerV2Status();
                    console.log('=== Modler V2 Professional UI Initialized ===');
                    console.log('System Status:', status);
                    console.log('UI Features:');
                    console.log('  - Professional toolbar with tool buttons');
                    console.log('  - Accordion panels for properties');
                    console.log('  - Scene hierarchy with object tree');
                    console.log('  - Object creation: Cube, Sphere, Plane');
                    console.log('  - Property editing: Position, Rotation, Scale');
                    console.log('  - Press 1: Select tool, 2: Move tool');
                    console.log('=== Ready for Professional 3D Modeling! ===');
                    
                    // Make components globally accessible for debugging
                    window.modlerV2Components = modlerV2Components;
                    window.modlerV2Metrics = modlerV2Metrics;
                    window.modlerUI = finalUI;
                    window.getModlerV2Status = getModlerV2Status;
                    
                } else {
                    console.error('Failed to initialize V2 system');
                    alert('Failed to initialize V2 system. Check console for details.');
                }
            }).catch((error) => {
                console.error('CRITICAL ERROR during V2 initialization:', error);
                alert('CRITICAL ERROR: ' + error.message + '\n\nCheck console for details.');
            });
            
        } catch (error) {
            console.error('CRITICAL ERROR during startup:', error);
            alert('CRITICAL ERROR: ' + error.message + '\n\nCheck console for details.');
        }
    </script>
</body>
</html>